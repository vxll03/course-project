meta {
  name: FILL_BOOK_DATABASE_TEST
  type: http
  seq: 4
}

get {
  url: {{local}}:8002/bookshop/books/
  body: none
  auth: inherit
}

script:pre-request {
  const API_BASE = 'http://localhost:8002/bookshop';
  
  // üîπ –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  const FIRST_NAMES = ['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä','–ú–∏—Ö–∞–∏–ª','–î–º–∏—Ç—Ä–∏–π','–ê–Ω–¥—Ä–µ–π','–°–µ—Ä–≥–µ–π','–ê–ª–µ–∫—Å–µ–π','–ò–≤–∞–Ω','–í–ª–∞–¥–∏–º–∏—Ä','–ê–Ω–Ω–∞','–ï–ª–µ–Ω–∞','–û–ª—å–≥–∞','–ú–∞—Ä–∏—è','–ù–∞—Ç–∞–ª—å—è','–ò—Ä–∏–Ω–∞','–°–≤–µ—Ç–ª–∞–Ω–∞','–¢–∞—Ç—å—è–Ω–∞'];
  const LAST_NAMES = ['–ò–≤–∞–Ω–æ–≤','–ü–µ—Ç—Ä–æ–≤','–°–∏–¥–æ—Ä–æ–≤','–°–º–∏—Ä–Ω–æ–≤','–ö—É–∑–Ω–µ—Ü–æ–≤','–ü–æ–ø–æ–≤','–õ–µ–±–µ–¥–µ–≤','–ö–æ–∑–ª–æ–≤','–ù–æ–≤–∏–∫–æ–≤','–ú–æ—Ä–æ–∑–æ–≤'];
  const SECOND_NAMES = ['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á','–ú–∏—Ö–∞–π–ª–æ–≤–∏—á','–î–º–∏—Ç—Ä–∏–µ–≤–∏—á','–ê–Ω–¥—Ä–µ–µ–≤–∏—á','–°–µ—Ä–≥–µ–µ–≤–∏—á','–ê–ª–µ–∫—Å–µ–µ–≤–∏—á'];
  const CATEGORY_NAMES = ['–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞','–î–µ—Ç–µ–∫—Ç–∏–≤','–†–æ–º–∞–Ω','–ü–æ—ç–∑–∏—è','–î—Ä–∞–º–∞','–ö–æ–º–µ–¥–∏—è','–¢—Ä–∞–≥–µ–¥–∏—è','–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π','–ë–∏–æ–≥—Ä–∞—Ñ–∏—è','–ù–∞—É—á–Ω—ã–π'];
  const CATEGORY_DESCRIPTIONS = CATEGORY_NAMES.map(name => `–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${name}`);
  const BOOK_TITLES = ['–¢–∞–π–Ω–∞ —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–º–∫–∞','–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∫ —Ü–µ–Ω—Ç—Ä—É –∑–µ–º–ª–∏','–ó–≤–µ–∑–¥–Ω—ã–µ –≤–æ–π–Ω—ã','–ú–∏—Ä –±—É–¥—É—â–µ–≥–æ','–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑ –º–æ–≥–∏–∫–∞–Ω'];
  const BOOK_DESCRIPTIONS = ['–ó–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∞—è –∏—Å—Ç–æ—Ä–∏—è','–ü—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑','–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ','–î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è','–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è'];
  
  // üîπ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  function getRandomElement(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
  }
  function getRandomInt(min,max) {
      return Math.floor(Math.random()*(max-min+1))+min;
  }
  function getRandomDate(start,end) {
      const date = new Date(start.getTime() + Math.random()*(end.getTime()-start.getTime()));
      return date.toISOString().split('T')[0];
  }
  
  // üîπ –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  const categories = [];
  function createCategory(i, callback) {
      if(i >= CATEGORY_NAMES.length) return callback();
      const data = { name: CATEGORY_NAMES[i], description: CATEGORY_DESCRIPTIONS[i] };
      pm.sendRequest({
          url: `${API_BASE}/categories/`,
          method: 'POST',
          header: { 'Content-Type': 'application/json' },
          body: { mode: 'raw', raw: JSON.stringify(data) }
      }, function(err, res){
          if(err || !res.json()) console.log(`‚ùå –û—à–∏–±–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${data.name}:`, err);
          else {
              categories.push(res.json());
              console.log(`‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞: ${data.name}`);
          }
          createCategory(i+1, callback);
      });
  }
  
  // üîπ –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤
  const authors = [];
  function createAuthor(i, callback) {
      if(i >= 50) return callback();
      const data = {
          last_name: getRandomElement(LAST_NAMES),
          first_name: getRandomElement(FIRST_NAMES),
          second_name: getRandomElement(SECOND_NAMES)
      };
      pm.sendRequest({
          url: `${API_BASE}/authors/`,
          method: 'POST',
          header: { 'Content-Type': 'application/json' },
          body: { mode: 'raw', raw: JSON.stringify(data) }
      }, function(err,res){
          if(err || !res.json()) console.log(`‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∞:`, err);
          else {
              authors.push(res.json());
              console.log(`‚úÖ –ê–≤—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω: ${data.last_name} ${data.first_name}`);
          }
          createAuthor(i+1, callback);
      });
  }
  
  // üîπ –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–∏–≥
  function createBook(i, callback) {
      if(i >= 100) return callback();
      if(categories.length === 0 || authors.length === 0) {
          console.log('‚ùå –ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–ª–∏ –∞–≤—Ç–æ—Ä–æ–≤ –¥–ª—è –∫–Ω–∏–≥–∏!');
          return callback();
      }
      const data = {
          title: getRandomElement(BOOK_TITLES)+' '+(i+1),
          description: getRandomElement(BOOK_DESCRIPTIONS),
          created: getRandomDate(new Date(1950,0,1), new Date(2023,11,31)),
          age_restriction: getRandomInt(0,18),
          category_id: getRandomElement(categories).id,
          author_id: getRandomElement(authors).id
      };
      pm.sendRequest({
          url: `${API_BASE}/books/`,
          method: 'POST',
          header: { 'Content-Type': 'application/json' },
          body: { mode: 'raw', raw: JSON.stringify(data) }
      }, function(err,res){
          if(err || !res.json()) console.log(`‚ùå –û—à–∏–±–∫–∞ –∫–Ω–∏–≥–∏ ${i+1}:`, err);
          else console.log(`üìñ –ö–Ω–∏–≥–∞ —Å–æ–∑–¥–∞–Ω–∞: ${data.title}`);
          createBook(i+1, callback);
      });
  }
  
  // üîπ –ó–∞–ø—É—Å–∫ —Ü–µ–ø–æ—á–∫–∏
  console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é...');
  createCategory(0, function(){
      console.log('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã');
      createAuthor(0, function(){
          console.log('‚úÖ –ê–≤—Ç–æ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã');
          createBook(0, function(){
              console.log('‚úÖ –í—Å–µ –∫–Ω–∏–≥–∏ —Å–æ–∑–¥–∞–Ω—ã!');
          });
      });
  });
  
}

settings {
  encodeUrl: true
}
